<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>√âdition √âv√©nement - SportConnect</title>

		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<script src="https://unpkg.com/lucide@latest"></script>

		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
		<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script src="js/config.js"></script>
		<script src="js/main.js" defer></script>

	    <link rel="stylesheet" href="style.css" />
</head>
	<body>
		<main>
			<div class="container">
				<div class="edit-layout">
					<div class="form-section">
						<div class="form-group">
							<label for="event-title">Titre de l'√©v√©nement</label
							><input type="text" id="event-title" name="title" />
						</div>
						<div class="form-group">
							<label for="event-description">Description</label
							><textarea id="event-description" name="description"></textarea>
						</div>
						<div class="form-group">
							<label for="event-date">Date(s)</label
							><input type="text" id="event-date" name="date" />
						</div>
						<div class="form-group">
							<label>Sports</label>
							<div id="event-sports" class="sport-tags"></div>
						</div>
						<div class="form-actions">
							<button class="btn-secondary">Annuler</button
							><button class="btn btn-primary">Enregistrer</button>
						</div>
					</div>
					<div class="info-panel">
						<div class="form-section">
							<div class="form-group">
								<label for="event-type">Type d'√©v√©nement</label>
								<select id="event-type" name="type">
									<option value="competition">Comp√©tition</option>
									<option value="balade">Balade</option>
									<option value="entrainement">Entra√Ænement</option>
									<option value="raid">Raid</option>
									<option value="detente">D√©tente</option>
								</select>
							</div>
							<div class="form-group">
								<label for="event-mode">Visibilit√©</label>
								<select id="event-mode" name="mode">
									<option value="public">Public</option>
									<option value="unlisted">Non r√©pertori√©</option>
									<option value="private">Priv√©</option>
								</select>
							</div>
							<div class="form-group">
								<label>Participants</label>
								<div class="participants-info">
									<div id="public-participants"></div>
									<div id="anon-participants"></div>
								</div>
								<div class="participants">
									<div id="avatar-group" class="avatar-group"></div>
								</div>
							</div>
							<div id="event-map"></div>
						</div>
					</div>
				</div>
				<div id="forum-section" class="form-section" style="margin-top: 2rem">
					<h2><i data-lucide="messages-square" class="icon"></i>Forum de discussion</h2>
					<div id="forum-topics"></div>
				</div>
			</div>
		</main>
		<script>
			const eventData = {
				id: 1,
				position: [47.28, -2.51],
				title: "R√©gate des Gl√©nans",
				sport: ["Voile.weta", "Voile.deriveur"],
				mode: "public",
				droits: "ecriture",
				type: "competition",
				nb_users_public: "4",
				nb_users_anonymes: "2",
				date: "15-17 juillet 2023",
				description:
					"R√©gate annuelle autour des √Æles de l'archipel. Ouverte √† tous les niveaux.",
				participants: ["JD", "MR", "TL", "SP"],
				topics: [
					{
						id: "covoit",
						title: "üöó Covoiturage depuis Nantes",
						messages: [
							{
								author: "Thomas L.",
								text: "Salut ! Je pars de Nantes le vendredi vers 17h, j'ai 2 places de libres dans ma voiture.",
								date: "2023-07-01",
							},
							{
								author: "Sophie P.",
								text: "@Thomas L. super ! Je suis int√©ress√©e, je t'envoie un MP.",
								date: "2023-07-01",
							},
						],
					},
					{
						id: "participation",
						title: "‚õµ participation inscription",
						messages: [
							{
								author: "Sophie P.",
								text: "peux tu indiquer le lien URL pour s'inscrire...",
								date: "2023-07-10",
							},
						],
					},
					{
						id: "materiel",
						title: "üõ†Ô∏è Pr√™t de mat√©riel",
						messages: [
							{
								author: "Jean D.",
								text: "J'en ai un de rechange @Sophie P., pas de souci.",
								date: "2023-07-10",
							},
						],
					},
				],
			};

			function renderEventDetails(data) {
				document.getElementById("event-title").value = data.title;
				document.getElementById("event-description").value = data.description;
				document.getElementById("event-date").value = data.date;
				document.getElementById("event-type").value = data.type;
				document.getElementById("event-mode").value = data.mode;
				const sportsContainer = document.getElementById("event-sports");
				sportsContainer.innerHTML = data.sport
					.map((s) => `<span class="sport-tag">${s.replace(".", " ")}</span>`)
					.join("");
				document.getElementById(
					"public-participants"
				).innerHTML = `<i data-lucide="users"></i><b>${data.nb_users_public}</b>`;
				document.getElementById(
					"anon-participants"
				).innerHTML = `<i data-lucide="user-x"></i><b>${data.nb_users_anonymes}</b>`;
				const avatarContainer = document.getElementById("avatar-group");
				avatarContainer.innerHTML = data.participants
					.map((p) => `<div class="avatar">${p}</div>`)
					.join("");
			}

			function renderForum(topics) {
				const topicsContainer = document.getElementById("forum-topics");
				topicsContainer.innerHTML = "";
				topics.forEach((topic) => {
					const topicElement = document.createElement("div");
					topicElement.className = "forum-topic";
					const messagesHtml = topic.messages
						.map(
							(msg) =>
								`<div class="forum-message"><header><span class="author">${
									msg.author
								}</span><span>${new Date(msg.date).toLocaleDateString(
									"fr-FR"
								)}</span></header><p>${msg.text}</p></div>`
						)
						.join("");
					topicElement.innerHTML = `<div class="topic-header"><span>${topic.title}</span><i data-lucide="chevron-down" class="icon"></i></div><div class="topic-messages">${messagesHtml}</div>`;
					topicsContainer.appendChild(topicElement);
				});
				document.querySelectorAll(".topic-header").forEach((header) => {
					header.addEventListener("click", () => {
						header.classList.toggle("active");
						header.nextElementSibling.classList.toggle("active");
					});
				});
			}

			function initMap(position, title) {
				const map = L.map("event-map").setView(position, 13);
				L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
				L.marker(position).addTo(map).bindPopup(title).openPopup();
			}

			document.addEventListener("DOMContentLoaded", () => {
				renderEventDetails(eventData);
				renderForum(eventData.topics);
				initMap(eventData.position, eventData.title);
				lucide.createIcons();
			});
		</script>
	</body>
</html>
